[tox]
isolated_build = True
envlist =
    py39-django{32,42}
    py310-django{32,42,50,51}
    py311-django{42,50,51}
    py312-django{42,50,51}
    py313-django{42,50,51}

# Parallel configuration
parallel_show_output = True

[testenv]
deps =
    django32: Django>=3.2,<4.0
    django42: Django>=4.2,<5.0
    django50: Django>=5.0,<5.1
    django51: Django>=5.1,<5.2
    -r requirements.txt
    pytest
    pytest-django
    pytest-asyncio
    pytest-cov
    pytest-xdist

setenv =
    PYTHONPATH = {toxinidir}

# Skip benchmarks and performance tests by default (much faster)
# Use `tox -- -m ""` to run all tests including benchmarks
# Note: We use -n 2 instead of -n auto to reduce race condition issues
# in chaos/random tests while still getting parallelization benefits
commands =
    pytest tests/unit tests/algorithms tests/integration --ignore=tests/integration/drf_integration/run_drf_tests.py --ignore=tests/performance -m "not benchmark and not slow" -n 2 -q --tb=line {posargs}

[gh-actions]
python =
    3.9: py39
    3.10: py310
    3.11: py311
    3.12: py312
    3.13: py313
